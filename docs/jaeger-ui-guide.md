# Jaeger UI 使用指南和分析教程

## 目录
- [简介](#简介)
- [界面概览](#界面概览)
- [基础操作](#基础操作)
- [追踪查询与筛选](#追踪查询与筛选)
- [分析和诊断技巧](#分析和诊断技巧)
- [高级功能使用](#高级功能使用)
- [实用案例和场景](#实用案例和场景)
- [最佳实践](#最佳实践)
- [常见问题解答](#常见问题解答)
- [演示场景](#演示场景)

## 简介

Jaeger UI 是 Jaeger 分布式追踪系统的用户界面，提供了强大的追踪数据查询、分析和可视化功能。本指南将帮助您掌握 Jaeger UI 的所有功能，从基础操作到高级分析技巧。

### 访问 Jaeger UI

默认情况下，Jaeger UI 可通过以下地址访问：
- **本地开发环境**: `http://localhost:16686`
- **Docker 容器**: `http://localhost:16686`
- **生产环境**: 根据部署配置确定

## 界面概览

### 主界面布局

Jaeger UI 主要包含以下几个区域：

1. **顶部导航栏**
   - Jaeger 标志和标题
   - 搜索功能入口
   - 系统状态指示器

2. **搜索面板**
   - 服务选择器
   - 操作筛选器
   - 时间范围选择器
   - 标签过滤器
   - 搜索按钮

3. **结果展示区域**
   - 追踪列表
   - 时间线视图
   - 详细信息面板

4. **功能面板**
   - 比较功能
   - 统计分析
   - 导出工具

### 核心功能菜单

- **搜索 (Search)**: 查询和筛选追踪数据
- **比较 (Compare)**: 对比多个追踪记录
- **系统架构 (System Architecture)**: 服务依赖关系图
- **监控 (Monitor)**: 系统性能监控面板

## 基础操作

### 1. 服务选择

**步骤:**
1. 在搜索面板中点击 "Service" 下拉菜单
2. 从列表中选择要查询的服务
3. 服务名称通常对应您的微服务名称（如：order-service, payment-service）

**示例:**
```bash
# 选择订单服务
Service: order-service

# 选择支付服务  
Service: payment-service
```

### 2. 操作筛选

**步骤:**
1. 选择服务后，"Operation" 下拉菜单将显示该服务的所有操作
2. 选择特定操作或保持 "all" 查看所有操作

**常见操作示例:**
- `HTTP GET /api/orders`
- `gRPC CreateOrder`
- `Database Query`
- `External API Call`

### 3. 时间范围选择

**预设时间范围:**
- Last 5 minutes
- Last 15 minutes  
- Last 1 hour
- Last 2 hours
- Last 1 day

**自定义时间范围:**
1. 点击时间选择器
2. 选择 "Custom" 选项
3. 设置开始和结束时间
4. 点击 "Apply" 应用设置

**最佳实践:**
- 开发调试：使用 5-15 分钟
- 性能分析：使用 1-2 小时
- 故障排查：根据问题发生时间设置

## 追踪查询与筛选

### 基础查询

**简单查询步骤:**
1. 选择服务
2. 选择时间范围
3. 点击 "Find Traces" 按钮

**查询结果展示:**
- 追踪数量和耗时统计
- 追踪列表（按时间倒序）
- 每个追踪的基本信息：
  - Trace ID
  - 开始时间
  - 总耗时
  - 服务数量
  - Span 数量

### 高级查询语法

**标签查询（Tags）:**
```bash
# 按用户ID查询
user.id:12345

# 按HTTP状态码查询
http.status_code:500

# 按错误查询
error:true

# 按自定义标签查询
order.status:failed

# 组合查询
http.status_code:500 user.id:12345
```

**操作符说明:**
- `=` 或 `:` : 等于
- `!=` : 不等于
- `>` : 大于
- `<` : 小于
- `>=` : 大于等于
- `<=` : 小于等于

### 查询筛选技巧

**1. 错误追踪查询**
```bash
# 查找所有错误
error:true

# 查找特定HTTP错误
http.status_code:>=400

# 查找特定错误类型
error.kind:timeout
```

**2. 性能问题查询**
```bash
# 查找超过1秒的请求
duration:>1s

# 查找超过100毫秒的数据库操作
component:database duration:>100ms
```

**3. 业务查询**
```bash
# 查找特定用户的操作
user.id:12345

# 查找特定订单的处理过程
order.id:ORD-12345

# 查找特定商品的操作
product.id:PROD-67890
```

## 分析和诊断技巧

### 1. 性能瓶颈识别

**查看追踪时间线:**
1. 点击感兴趣的追踪记录
2. 查看时间线视图（Timeline View）
3. 分析各个 Span 的耗时占比

**识别慢操作:**
- 查找颜色较深的 Span（耗时较长）
- 关注水平条最长的操作
- 检查并发执行情况

**性能分析要点:**
- **数据库查询**: 查找 `db.statement` 标签
- **HTTP调用**: 检查 `http.url` 和 `http.status_code`
- **缓存操作**: 查看 cache hit/miss 情况
- **消息队列**: 检查队列处理时间

### 2. 错误分析流程

**错误追踪步骤:**
1. 使用 `error:true` 查询所有错误
2. 点击错误追踪查看详细信息
3. 检查错误 Span 的标签和日志
4. 分析错误传播路径

**错误信息查看:**
- **Tags 面板**: 查看错误相关标签
- **Process 面板**: 查看服务信息
- **Logs 面板**: 查看详细错误日志

**常见错误标签:**
```bash
error: true
error.kind: timeout
error.object: SQLException  
http.status_code: 500
```

### 3. 服务依赖分析

**依赖关系视图:**
1. 选择服务后点击 "System Architecture"
2. 查看服务间调用关系图
3. 分析服务依赖深度和复杂度

**调用链分析:**
- 识别关键路径服务
- 查找单点故障服务
- 分析服务调用频率

### 4. 调用链路优化建议

**性能优化分析:**

**并发优化:**
- 识别可并行执行的操作
- 查找串行执行的瓶颈点
- 分析异步处理机会

**缓存优化:**
- 分析重复的数据库查询
- 识别可缓存的计算结果
- 检查缓存命中率

**数据库优化:**
- 查找慢查询语句
- 分析查询执行次数
- 识别 N+1 查询问题

## 高级功能使用

### 1. 追踪比较功能

**使用步骤:**
1. 在搜索结果中选择要比较的追踪
2. 点击 "Compare" 按钮
3. 添加其他要比较的追踪
4. 查看对比结果

**比较分析:**
- 执行时间对比
- Span 结构差异
- 标签值对比
- 执行路径差异

**应用场景:**
- 性能回归分析
- A/B 测试结果对比
- 不同版本功能对比
- 异常与正常情况对比

### 2. 统计图表分析

**时间分布图:**
- 查看请求量随时间的变化
- 识别流量峰值和低谷
- 分析访问模式

**耗时分布图:**
- 查看响应时间分布情况
- 识别性能异常点
- 分析性能稳定性

### 3. 自定义搜索查询

**复杂查询示例:**
```bash
# 查找支付失败的订单处理
service:order-service operation:create-order payment.status:failed

# 查找特定时间段的慢查询
service:database-service duration:>500ms

# 查找特定用户的错误操作
user.id:12345 error:true

# 查找跨服务的完整业务流程
trace.contains:order-service,payment-service,inventory-service
```

**查询结果导出:**
1. 执行查询获得结果
2. 点击 "Export" 按钮
3. 选择导出格式（JSON/CSV）
4. 下载导出文件

### 4. 数据导出功能

**支持的导出格式:**
- **JSON**: 完整的追踪数据
- **CSV**: 表格化的统计数据  
- **Zipkin**: 兼容 Zipkin 格式

**导出应用:**
- 离线分析
- 报告生成
- 数据备份
- 系统集成

## 实用案例和场景

### 案例1: 典型故障排查

**场景描述:**
用户报告订单创建功能响应缓慢，需要定位性能问题。

**排查步骤:**

1. **初步查询**
   ```bash
   Service: order-service
   Operation: create-order
   Time Range: Last 1 hour
   Tags: 无
   ```

2. **分析结果**
   - 发现平均响应时间为 3.2 秒（正常应为 < 1秒）
   - 90% 的请求耗时超过 2 秒

3. **深入分析**
   - 点击耗时最长的追踪记录
   - 查看时间线视图
   - 发现数据库查询占用 2.1 秒

4. **根本原因**
   - 检查数据库查询 Span
   - 发现缺少索引导致全表扫描
   - 标签显示：`db.statement: SELECT * FROM orders WHERE customer_id = ?`

5. **解决方案**
   - 为 customer_id 字段添加索引
   - 优化查询语句
   - 验证修复效果

### 案例2: 性能优化分析

**场景描述:**
需要对支付服务进行性能优化分析。

**分析步骤:**

1. **基准测试数据收集**
   ```bash
   Service: payment-service
   Time Range: Last 24 hours
   Tags: 无
   ```

2. **性能指标分析**
   - 平均响应时间：450ms
   - 99th 百分位：1.2s
   - 错误率：0.8%

3. **瓶颈识别**
   - 外部支付 API 调用：300ms（67%）
   - 数据库操作：100ms（22%）
   - 业务逻辑处理：50ms（11%）

4. **优化建议**
   - 实现支付 API 连接池
   - 添加数据库查询缓存
   - 异步处理非关键操作

### 案例3: 业务流程追踪

**场景描述:**
追踪完整的电商下单流程，分析各服务协作情况。

**追踪查询:**
```bash
Service: api-gateway
Operation: POST /orders
Tags: order.id:ORD-12345
Time Range: Last 1 hour
```

**流程分析:**
1. **API Gateway** (50ms)
   - 请求验证和路由

2. **Order Service** (800ms)  
   - 订单创建和验证
   - 调用库存服务检查
   - 调用支付服务处理

3. **Inventory Service** (200ms)
   - 库存检查和预留

4. **Payment Service** (400ms)
   - 支付处理和验证

5. **Notification Service** (100ms)
   - 发送确认通知

**发现的问题:**
- Order Service 内部处理过慢
- 服务间调用存在重试逻辑
- 通知服务可以异步处理

### 案例4: 多服务协作分析

**场景描述:**
分析微服务架构中的服务间通信模式和性能影响。

**分析维度:**
1. **调用关系分析**
   - 使用 System Architecture 视图
   - 识别核心服务和边缘服务
   - 分析服务调用深度

2. **性能影响分析**
   - 查看跨服务调用的延迟
   - 分析网络传输时间
   - 识别同步调用瓶颈

3. **错误传播分析**
   - 追踪错误在服务间的传播
   - 分析熔断器工作情况
   - 评估容错机制有效性

## 最佳实践

### 1. 查询优化建议

**时间范围选择:**
- 开发调试：5-15分钟
- 性能分析：1-4小时  
- 趋势分析：1天-1周
- 避免过长时间范围影响性能

**标签使用建议:**
- 使用具体的业务标签
- 避免使用模糊匹配
- 组合使用多个标签提高精度

**查询性能优化:**
- 优先使用服务和操作过滤
- 合理使用时间范围
- 避免使用通配符查询

### 2. 分析工作流程

**故障排查流程:**
1. 从错误查询开始
2. 缩小时间范围
3. 分析错误模式
4. 深入单个追踪
5. 验证修复效果

**性能分析流程:**
1. 收集基准数据
2. 识别性能瓶颈
3. 分析根本原因
4. 制定优化方案
5. 验证优化效果

### 3. 监控策略建议

**关键指标监控:**
- 错误率趋势
- 响应时间分布
- 服务可用性
- 业务成功率

**告警设置建议:**
- 错误率超过阈值
- 响应时间异常
- 服务不可用
- 业务指标异常

## 常见问题解答

### Q1: 为什么看不到追踪数据？

**可能原因:**
1. 服务未正确配置追踪
2. 时间范围选择错误
3. 采样率设置过低
4. 服务名称拼写错误

**解决方案:**
- 检查 OpenTelemetry 配置
- 调整时间范围
- 检查采样配置
- 验证服务名称

### Q2: 追踪数据不完整怎么办？

**常见情况:**
- 部分 Span 丢失
- 跨服务追踪断裂
- 异步操作未追踪

**解决方案:**
- 检查网络连接
- 验证追踪上下文传递
- 配置异步操作追踪

### Q3: 如何处理大量追踪数据？

**性能优化:**
- 使用合适的时间范围
- 添加更多过滤条件
- 使用标签缩小范围
- 考虑数据归档策略

### Q4: UI 响应缓慢怎么办？

**优化建议:**
- 减少查询时间范围
- 使用更具体的过滤条件
- 检查 Jaeger 后端性能
- 优化存储配置

### Q5: 如何自定义 UI 配置？

**配置方法:**
- 修改 Jaeger Query 服务配置
- 设置 UI 相关环境变量
- 自定义 UI 资源文件
- 参考官方配置文档

---

## 总结

Jaeger UI 是一个功能强大的分布式追踪分析工具。通过掌握本指南中的操作技巧和分析方法，您可以：

- 快速定位系统性能问题
- 有效进行故障诊断和排查
- 深入分析服务间依赖关系
- 优化微服务架构性能
- 监控业务流程执行情况

**持续学习建议:**
- 实践不同的查询场景
- 关注 Jaeger 社区更新
- 结合业务需求定制分析方法
- 建立团队最佳实践规范

## 演示场景

为了帮助您更好地理解和掌握 Jaeger UI 的使用，我们提供了详细的演示场景和实际示例数据。

### 快速开始演示

1. **启动演示环境**
   ```bash
   cd examples/distributed-tracing
   ./scripts/setup.sh
   ```

2. **生成示例数据**
   ```bash
   ./scripts/demo-scenarios.sh
   ```

3. **访问 Jaeger UI**
   - 打开浏览器访问: `http://localhost:16686`
   - 按照本指南的步骤进行操作练习

### 实践场景

详细的演示场景和示例数据请参考：[Jaeger UI 演示场景文档](jaeger-ui-demo-scenarios.md)

包含的演示场景：
- **正常业务流程**: 完整的订单创建追踪
- **错误处理演示**: 支付失败和异常处理
- **性能瓶颈分析**: 数据库慢查询识别
- **高并发测试**: 系统负载下的行为分析

### 截图说明

> **注意**: 实际的界面截图将在演示环境运行后生成。建议您在实际环境中操作以获得最佳学习体验。

主要界面包括：
- **搜索界面**: 显示服务选择、时间范围和查询条件
- **追踪列表**: 展示查询结果和追踪摘要信息
- **追踪详情**: 显示完整的追踪时间线和 Span 详情
- **比较界面**: 多个追踪的对比分析视图

---

**相关资源:**
- [Jaeger 官方文档](https://www.jaegertracing.io/docs/)
- [OpenTelemetry 文档](https://opentelemetry.io/docs/)
- [SWIT 框架文档](../README.md)
- [分布式追踪示例](../examples/distributed-tracing/README.md)
- [Jaeger UI 演示场景](jaeger-ui-demo-scenarios.md)

---

*本指南持续更新中，建议关注项目仓库获取最新版本。如有问题或建议，欢迎通过 Issue 反馈。*
