# Swit 安全检查清单

本文档提供了一个全面的安全检查清单，涵盖从开发到生产部署的各个阶段。使用此清单确保应用程序遵循安全最佳实践。

## 📋 快速参考

- ✅ 已完成
- ⚠️ 需要注意
- ❌ 未完成/不适用

---

## 目录

- [开发阶段](#开发阶段)
- [代码审查](#代码审查)
- [测试阶段](#测试阶段)
- [部署前检查](#部署前检查)
- [生产环境配置](#生产环境配置)
- [持续监控](#持续监控)
- [定期审计](#定期审计)

---

## 开发阶段

### 身份认证

- [ ] 使用 OAuth2/OIDC 进行身份认证
- [ ] 启用 JWT 令牌验证
- [ ] 配置适当的令牌过期时间（不超过 1 小时）
- [ ] 实现令牌刷新机制
- [ ] 使用非对称加密（RS256）而非对称加密（HS256）
- [ ] 验证所有必需的 JWT 声明（sub, exp, iat）
- [ ] 实现令牌黑名单机制
- [ ] 密码长度至少 12 个字符
- [ ] 密码包含大小写字母、数字和特殊字符
- [ ] 使用 bcrypt 或 Argon2 进行密码哈希
- [ ] 实现账户锁定机制（防止暴力破解）
- [ ] 支持多因素认证（MFA）

### 授权

- [ ] 使用 OPA 策略引擎进行授权
- [ ] 实现基于角色的访问控制（RBAC）
- [ ] 实现基于属性的访问控制（ABAC）（如需要）
- [ ] 每个请求都检查权限
- [ ] 实现资源所有者检查
- [ ] 默认拒绝所有访问
- [ ] 日志记录所有授权决策
- [ ] 定期审查和更新策略
- [ ] 策略文件存储在版本控制中
- [ ] 实现策略测试

### 输入验证

- [ ] 验证所有用户输入
- [ ] 使用结构体标签进行验证
- [ ] 实现自定义验证规则
- [ ] 验证文件上传（类型、大小、内容）
- [ ] 限制请求体大小
- [ ] 验证 URL 参数
- [ ] 验证查询参数
- [ ] 验证头部信息
- [ ] 白名单验证优于黑名单
- [ ] 返回通用错误消息（不泄露详情）

### 输出编码

- [ ] HTML 输出进行转义
- [ ] JavaScript 输出进行转义
- [ ] URL 参数进行编码
- [ ] JSON 响应自动编码
- [ ] 避免直接渲染用户输入
- [ ] 使用 Content-Type 正确设置

### 数据保护

- [ ] 敏感数据库字段加密
- [ ] 使用 AES-256 加密
- [ ] 密钥存储在安全位置（非代码库）
- [ ] 实现密钥轮换机制
- [ ] PII 数据脱敏（日志和响应）
- [ ] 信用卡数据符合 PCI-DSS
- [ ] 健康数据符合 HIPAA（如适用）
- [ ] 个人数据符合 GDPR（如适用）
- [ ] 数据库启用静态加密
- [ ] 备份数据加密

### SQL 注入防护

- [ ] 使用参数化查询
- [ ] 使用 ORM（GORM）
- [ ] 避免字符串拼接 SQL
- [ ] 限制数据库用户权限
- [ ] 禁用不必要的数据库功能
- [ ] 输入验证（额外防护）

### XSS 防护

- [ ] 实现内容安全策略（CSP）
- [ ] 设置 X-Content-Type-Options: nosniff
- [ ] 设置 X-Frame-Options: DENY
- [ ] 设置 X-XSS-Protection: 1; mode=block
- [ ] HTML 转义所有用户输入
- [ ] 使用 HTTPOnly Cookie
- [ ] 使用 Secure Cookie（HTTPS）
- [ ] 验证和清理富文本内容

### CSRF 防护

- [ ] 实现 CSRF 令牌
- [ ] 使用 SameSite Cookie 属性
- [ ] 验证 Origin/Referer 头部
- [ ] 状态变更使用 POST/PUT/DELETE
- [ ] 避免 GET 请求改变状态

### 命令注入防护

- [ ] 避免执行 shell 命令
- [ ] 如必需，使用参数数组而非字符串
- [ ] 验证和清理所有输入
- [ ] 使用最小权限执行命令
- [ ] 记录所有命令执行

### 密钥管理

- [ ] 无硬编码密钥
- [ ] 使用环境变量
- [ ] 使用密钥管理系统（Vault、AWS Secrets Manager）
- [ ] 密钥定期轮换（至少每 90 天）
- [ ] 分离开发和生产密钥
- [ ] 限制密钥访问权限
- [ ] 审计密钥访问日志
- [ ] 撤销时立即删除密钥

### 错误处理

- [ ] 捕获所有错误
- [ ] 不在响应中暴露堆栈跟踪
- [ ] 不在响应中暴露系统详情
- [ ] 返回通用错误消息给用户
- [ ] 详细错误记录到日志
- [ ] 实现全局错误处理器
- [ ] 区分客户端和服务器错误

### 日志记录

- [ ] 记录所有身份认证事件
- [ ] 记录所有授权失败
- [ ] 记录所有敏感数据访问
- [ ] 日志包含时间戳
- [ ] 日志包含用户标识
- [ ] 日志包含 IP 地址
- [ ] 日志不包含敏感数据（密码、令牌）
- [ ] 使用结构化日志（JSON）
- [ ] 实现日志轮换
- [ ] 日志发送到集中式系统

---

## 代码审查

### 安全代码审查

- [ ] 检查硬编码密钥
- [ ] 检查 SQL 注入漏洞
- [ ] 检查 XSS 漏洞
- [ ] 检查 CSRF 漏洞
- [ ] 检查命令注入漏洞
- [ ] 检查路径遍历漏洞
- [ ] 检查不安全的反序列化
- [ ] 检查竞态条件
- [ ] 检查整数溢出
- [ ] 检查不安全的随机数生成
- [ ] 检查时区处理
- [ ] 检查资源泄漏

### 依赖审查

- [ ] 审查新增依赖的安全性
- [ ] 检查依赖的许可证
- [ ] 确认依赖来自可信源
- [ ] 检查依赖的维护状态
- [ ] 审查依赖的已知漏洞
- [ ] 固定依赖版本（使用 go.sum）
- [ ] 最小化依赖数量

### 配置审查

- [ ] 审查安全配置
- [ ] 确认 TLS 已启用
- [ ] 确认最低 TLS 版本为 1.2
- [ ] 审查 CORS 配置
- [ ] 审查速率限制配置
- [ ] 审查会话配置
- [ ] 审查超时配置
- [ ] 确认生产环境禁用调试模式

---

## 测试阶段

### 静态代码分析

- [ ] 运行 `gosec` 扫描
- [ ] 运行 `staticcheck` 分析
- [ ] 运行 `go vet` 检查
- [ ] 修复所有高危问题
- [ ] 审查中危问题
- [ ] 文档化已接受的风险

### 依赖漏洞扫描

- [ ] 运行 `govulncheck` 检查
- [ ] 运行 `trivy` 扫描
- [ ] 更新有漏洞的依赖
- [ ] 文档化无法更新的依赖
- [ ] 实施缓解措施

### 单元测试

- [ ] 密码验证测试
- [ ] 输入验证测试
- [ ] XSS 防护测试
- [ ] SQL 注入防护测试
- [ ] 加密/解密测试
- [ ] 哈希验证测试
- [ ] 权限检查测试
- [ ] 测试覆盖率 > 80%

### 集成测试

- [ ] OAuth2 认证流程测试
- [ ] JWT 验证测试
- [ ] OPA 授权测试
- [ ] API 端点安全测试
- [ ] 中间件测试
- [ ] 端到端认证测试

### 安全测试

- [ ] 渗透测试（OWASP ZAP）
- [ ] 模糊测试
- [ ] 会话管理测试
- [ ] 访问控制测试
- [ ] 文件上传测试
- [ ] API 安全测试

### 性能测试

- [ ] 负载测试
- [ ] 压力测试
- [ ] DDoS 防护测试
- [ ] 速率限制测试
- [ ] 资源限制测试

---

## 部署前检查

### 容器安全

- [ ] 使用最小基础镜像（alpine）
- [ ] 指定镜像版本标签（不使用 latest）
- [ ] 以非 root 用户运行
- [ ] 只读根文件系统
- [ ] 禁用特权升级
- [ ] 删除所有 capabilities
- [ ] 扫描镜像漏洞
- [ ] 签名和验证镜像
- [ ] 使用多阶段构建
- [ ] 最小化镜像层数

### Kubernetes 安全

- [ ] 设置 Pod Security Policy
- [ ] 配置 Security Context
- [ ] 实现 Network Policy
- [ ] 使用 RBAC 限制权限
- [ ] 启用审计日志
- [ ] 使用 Secrets 存储敏感数据
- [ ] 不将 Secrets 作为环境变量（使用卷）
- [ ] 定期轮换 Secrets
- [ ] 限制容器资源
- [ ] 实现健康检查

### CI/CD 安全

- [ ] 保护 CI/CD 凭据
- [ ] 限制 CI/CD 访问权限
- [ ] 在 CI 中运行安全扫描
- [ ] 扫描 Docker 镜像
- [ ] 门控部署（安全检查通过）
- [ ] 审计 CI/CD 日志
- [ ] 使用专用构建环境
- [ ] 签名构建产物

### 配置验证

- [ ] 运行配置验证命令
- [ ] 检查所有必需的环境变量
- [ ] 验证证书有效性
- [ ] 验证 TLS 配置
- [ ] 验证数据库连接
- [ ] 验证外部服务连接
- [ ] 检查日志配置
- [ ] 检查监控配置

---

## 生产环境配置

### TLS/SSL

- [ ] 启用 HTTPS
- [ ] 强制 HTTPS（重定向 HTTP）
- [ ] 最低 TLS 1.2
- [ ] 推荐 TLS 1.3
- [ ] 使用强密码套件
- [ ] 禁用弱密码套件
- [ ] 启用 HSTS
- [ ] 配置证书
- [ ] 证书来自可信 CA
- [ ] 证书在有效期内
- [ ] 实现证书自动续期
- [ ] 配置 mTLS（服务间通信）

### 防火墙和网络

- [ ] 配置防火墙规则
- [ ] 最小化开放端口
- [ ] 限制入站流量
- [ ] 限制出站流量
- [ ] 实现网络隔离
- [ ] 使用私有网络（VPC）
- [ ] 配置 DDoS 防护
- [ ] 实现 WAF（Web 应用防火墙）

### 身份认证和授权

- [ ] OAuth2/OIDC 配置正确
- [ ] JWT 密钥安全存储
- [ ] 启用令牌刷新
- [ ] 配置令牌过期时间
- [ ] OPA 策略加载正确
- [ ] 策略缓存配置正确
- [ ] 审计日志启用
- [ ] MFA 启用（管理员）

### 数据库安全

- [ ] 使用强密码
- [ ] 限制数据库访问（IP 白名单）
- [ ] 使用最小权限账户
- [ ] 启用 SSL/TLS 连接
- [ ] 启用静态加密
- [ ] 启用传输加密
- [ ] 实现定期备份
- [ ] 备份加密
- [ ] 测试恢复流程
- [ ] 审计数据库访问

### 服务器配置

- [ ] 禁用调试模式
- [ ] 禁用错误详情暴露
- [ ] 配置速率限制
- [ ] 配置请求大小限制
- [ ] 配置超时
- [ ] 限制并发连接
- [ ] 禁用不必要的服务
- [ ] 删除默认账户
- [ ] 最小化安装包

### 监控和日志

- [ ] 启用审计日志
- [ ] 启用应用日志
- [ ] 启用访问日志
- [ ] 日志发送到集中式系统
- [ ] 配置日志保留期
- [ ] 实现实时监控
- [ ] 配置安全告警
- [ ] 配置性能监控
- [ ] 实现健康检查
- [ ] 配置指标收集

### 备份和恢复

- [ ] 实现自动备份
- [ ] 加密备份
- [ ] 异地存储备份
- [ ] 定期测试恢复
- [ ] 文档化恢复流程
- [ ] 备份配置文件
- [ ] 备份数据库
- [ ] 备份密钥（安全存储）

---

## 持续监控

### 安全监控

- [ ] 监控认证失败
- [ ] 监控授权拒绝
- [ ] 监控异常流量
- [ ] 监控 API 滥用
- [ ] 监控系统变更
- [ ] 监控配置变更
- [ ] 监控用户行为
- [ ] 监控文件完整性

### 告警配置

- [ ] 高认证失败率告警
- [ ] 频繁授权拒绝告警
- [ ] 异常流量告警
- [ ] 服务不可用告警
- [ ] 高延迟告警
- [ ] 证书即将过期告警
- [ ] 磁盘空间不足告警
- [ ] 资源耗尽告警

### 性能监控

- [ ] 监控响应时间
- [ ] 监控错误率
- [ ] 监控吞吐量
- [ ] 监控 CPU 使用率
- [ ] 监控内存使用率
- [ ] 监控磁盘 I/O
- [ ] 监控网络 I/O
- [ ] 监控数据库性能

### 日志分析

- [ ] 定期审查审计日志
- [ ] 分析异常模式
- [ ] 检测可疑活动
- [ ] 追踪安全事件
- [ ] 生成安全报告
- [ ] 趋势分析

---

## 定期审计

### 每周检查

- [ ] 审查安全告警
- [ ] 检查系统补丁
- [ ] 审查访问日志
- [ ] 检查证书有效期
- [ ] 审查用户账户
- [ ] 检查备份状态

### 每月检查

- [ ] 运行漏洞扫描
- [ ] 更新依赖
- [ ] 审查安全配置
- [ ] 审查访问权限
- [ ] 测试备份恢复
- [ ] 审查安全策略
- [ ] 审查监控配置
- [ ] 生成安全报告

### 每季度检查

- [ ] 渗透测试
- [ ] 安全审计
- [ ] 策略审查
- [ ] 架构审查
- [ ] 访问权限审查
- [ ] 密钥轮换
- [ ] 灾难恢复演练
- [ ] 安全培训

### 每年检查

- [ ] 全面安全审计
- [ ] 合规性审查
- [ ] 第三方安全评估
- [ ] 灾难恢复测试
- [ ] 业务连续性测试
- [ ] 更新安全策略
- [ ] 更新应急响应计划
- [ ] 安全意识培训

---

## 应急准备

### 事件响应计划

- [ ] 制定事件响应计划
- [ ] 定义响应团队
- [ ] 定义角色和职责
- [ ] 建立沟通渠道
- [ ] 准备响应工具
- [ ] 文档化响应流程
- [ ] 定期演练
- [ ] 审查和更新计划

### 联系信息

- [ ] 安全团队联系方式
- [ ] 管理层联系方式
- [ ] 外部专家联系方式
- [ ] 法律顾问联系方式
- [ ] 云服务提供商支持
- [ ] 保险公司联系方式

### 工具和资源

- [ ] 日志分析工具
- [ ] 取证工具
- [ ] 备份恢复工具
- [ ] 通信工具
- [ ] 文档模板
- [ ] 联系列表

---

## 合规性检查

### GDPR（如适用）

- [ ] 数据保护影响评估（DPIA）
- [ ] 数据处理协议
- [ ] 用户同意机制
- [ ] 数据访问请求流程
- [ ] 数据删除机制
- [ ] 数据可移植性
- [ ] 违规通知流程（72 小时）
- [ ] 数据保护官（DPO）指定

### PCI-DSS（如适用）

- [ ] 防火墙配置
- [ ] 禁用默认密码
- [ ] 保护存储的持卡人数据
- [ ] 加密传输的持卡人数据
- [ ] 使用和更新防病毒软件
- [ ] 开发和维护安全系统
- [ ] 限制持卡人数据访问
- [ ] 分配唯一 ID
- [ ] 限制物理访问
- [ ] 追踪和监控网络访问
- [ ] 定期测试安全系统
- [ ] 维护信息安全策略

### HIPAA（如适用）

- [ ] 访问控制
- [ ] 审计控制
- [ ] 完整性控制
- [ ] 传输安全
- [ ] 风险分析
- [ ] 风险管理
- [ ] 违规通知
- [ ] 业务关联协议

---

## 工具和命令

### 安全扫描

```bash
# 静态代码分析
make quality

# 依赖漏洞扫描
make security

# gosec 扫描
gosec ./...

# govulncheck 检查
govulncheck ./...

# Trivy 扫描
trivy fs .
trivy image myservice:latest

# 容器镜像扫描
docker scan myservice:latest
```

### 配置验证

```bash
# 验证配置
./myservice --validate-config

# 检查 TLS 配置
openssl s_client -connect myservice.example.com:443

# 测试证书有效性
openssl x509 -in cert.pem -text -noout

# 检查密码套件
nmap --script ssl-enum-ciphers -p 443 myservice.example.com
```

### 渗透测试

```bash
# OWASP ZAP 扫描
zap-cli quick-scan http://localhost:8080

# Nmap 扫描
nmap -sV -p- myservice.example.com

# Nikto Web 扫描
nikto -h http://localhost:8080
```

---

## 参考资料

### 内部文档

- [安全最佳实践指南](./security-best-practices.md)
- [事件响应流程](./security-incident-response.md)
- [安全配置参考](./api/security-config.md)
- [OAuth2/OIDC 配置](./api/security-oauth2.md)
- [OPA 策略配置](./api/security-opa.md)

### 外部标准

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [CIS Benchmarks](https://www.cisecurity.org/cis-benchmarks/)
- [NIST Cybersecurity Framework](https://www.nist.gov/cyberframework)
- [PCI DSS](https://www.pcisecuritystandards.org/)
- [GDPR](https://gdpr.eu/)
- [HIPAA](https://www.hhs.gov/hipaa/)

---

## 使用说明

### 如何使用此清单

1. **项目启动时**：完成所有开发阶段检查项
2. **代码审查时**：使用代码审查部分
3. **测试阶段**：执行所有测试检查项
4. **部署前**：完成部署前检查
5. **部署后**：验证生产环境配置
6. **持续运维**：按照定期审计计划执行

### 检查记录

建议记录每次检查的结果：

```markdown
## 检查记录

**日期**: 2024-11-24
**检查人**: John Doe
**阶段**: 部署前检查

| 项目 | 状态 | 备注 |
|------|------|------|
| TLS 启用 | ✅ | TLS 1.3 |
| 证书有效期 | ✅ | 有效至 2025-12-31 |
| 密钥管理 | ✅ | 使用 Vault |
| ... | ... | ... |

**遗留问题**:
1. 需要启用 MFA
2. 需要配置 WAF

**计划**:
- 2024-12-01: 实现 MFA
- 2024-12-15: 配置 WAF
```

---

## 许可证

Copyright (c) 2024-2025 Six-Thirty Labs, Inc.

Licensed under the Apache License, Version 2.0.


