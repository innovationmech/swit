# Sentry Integration Testing Workflow

è¿™ä¸ª GitHub Action ä¸“é—¨ç”¨äºæµ‹è¯•é¡¹ç›®ä¸­çš„ Sentry é”™è¯¯ç›‘æ§é›†æˆã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ”„ è‡ªåŠ¨è§¦å‘æ¡ä»¶
- **Push** åˆ° `master/main` åˆ†æ”¯æ—¶
- **Pull Request** åˆ° `master/main` åˆ†æ”¯æ—¶  
- å½“ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶æ—¶ï¼š
  - `examples/sentry-example-service/**`
  - `pkg/server/sentry*`
  - `pkg/middleware/sentry*`
  - `.github/workflows/sentry-integration-test.yml`
- **æ‰‹åŠ¨è§¦å‘** (workflow_dispatch)

### ğŸ§ª æµ‹è¯•æ¨¡å¼

#### 1. ç¦ç”¨æ¨¡å¼ (disabled)
- ä¸è®¾ç½® `SENTRY_DSN` ç¯å¢ƒå˜é‡
- éªŒè¯åº”ç”¨åœ¨æ²¡æœ‰ Sentry çš„æƒ…å†µä¸‹æ­£å¸¸å·¥ä½œ
- æµ‹è¯•å¥åº·æ£€æŸ¥å’ŒåŸºæœ¬åŠŸèƒ½

#### 2. æ¨¡æ‹Ÿ DSN æ¨¡å¼ (mock_dsn)  
- ä½¿ç”¨è™šå‡çš„ Sentry DSN
- æµ‹è¯• Sentry ä¸­é—´ä»¶å’Œé”™è¯¯å¤„ç†é€»è¾‘
- éªŒè¯æ‰€æœ‰ç«¯ç‚¹åŠŸèƒ½
- ä¸ä¼šå‘é€çœŸå®æ•°æ®åˆ° Sentry

#### 3. çœŸå® DSN æ¨¡å¼ (real_dsn)
- ä½¿ç”¨å­˜å‚¨åœ¨ GitHub Secrets ä¸­çš„çœŸå® `SENTRY_DSN`
- å®é™…å‘é€é”™è¯¯å’Œäº‹ä»¶åˆ° Sentry ä»ªè¡¨æ¿
- åªåœ¨ä»¥ä¸‹æƒ…å†µä¸‹è¿è¡Œï¼š
  - æ‰‹åŠ¨è§¦å‘ä¸”é€‰æ‹©äº† `test_real_sentry: true`
  - æ¨é€åˆ° `master` åˆ†æ”¯

## è®¾ç½®æŒ‡å—

### 1. é…ç½® GitHub Secrets

åœ¨ä½ çš„ GitHub ä»“åº“ä¸­æ·»åŠ ä»¥ä¸‹ Secretï¼š

1. è¿›å…¥ä»“åº“ Settings â†’ Secrets and variables â†’ Actions
2. ç‚¹å‡» "New repository secret"
3. æ·»åŠ ï¼š
   - **Name**: `SENTRY_DSN`
   - **Value**: `https://your-key@sentry.io/your-project-id`

### 2. æ‰‹åŠ¨è¿è¡Œæµ‹è¯•

è¦æµ‹è¯•çœŸå®çš„ Sentry é›†æˆï¼š

1. è¿›å…¥ Actions æ ‡ç­¾é¡µ
2. é€‰æ‹© "Sentry Integration Test" workflow
3. ç‚¹å‡» "Run workflow"
4. å‹¾é€‰ "Test with real Sentry DSN"
5. ç‚¹å‡» "Run workflow"

### 3. æŸ¥çœ‹ç»“æœ

è¿è¡Œåä½ å¯ä»¥ï¼š

- åœ¨ GitHub Actions ä¸­æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
- åœ¨ Sentry ä»ªè¡¨æ¿ä¸­çœ‹åˆ°å®é™…çš„é”™è¯¯å’Œäº‹ä»¶
- æŸ¥çœ‹ç”Ÿæˆçš„æµ‹è¯•æ‘˜è¦æŠ¥å‘Š

## æµ‹è¯•çš„ç«¯ç‚¹

### è‡ªåŠ¨æµ‹è¯•çš„ Sentry åŠŸèƒ½

#### é”™è¯¯æ•è·
- `GET /api/v1/error` - è§¦å‘ HTTP 500 é”™è¯¯
- è‡ªåŠ¨æ•è·å’Œä¸ŠæŠ¥åˆ° Sentry

#### è‡ªå®šä¹‰äº‹ä»¶
- `GET /api/v1/custom-sentry` - å‘é€è‡ªå®šä¹‰äº‹ä»¶
- åŒ…å«è‡ªå®šä¹‰æ ‡ç­¾å’Œä¸Šä¸‹æ–‡

#### æ€§èƒ½ç›‘æ§
- `POST /api/v1/users` - ç”¨æˆ·åˆ›å»ºæµç¨‹
- åŒ…å«äº‹åŠ¡è¿½è¸ªå’Œæ€§èƒ½æŒ‡æ ‡
- è®¾ç½®ç”¨æˆ·ä¸Šä¸‹æ–‡ä¿¡æ¯

#### å¿½ç•¥çš„ç«¯ç‚¹
- `GET /health` - å¥åº·æ£€æŸ¥ (è¢« Sentry å¿½ç•¥)
- `GET /api/v1/success` - æˆåŠŸå“åº” (ä¸ä¼šè¢«æ•è·)

## é¢„æœŸçš„ Sentry æ•°æ®

è¿è¡ŒçœŸå® DSN æµ‹è¯•åï¼Œä½ åº”è¯¥åœ¨ Sentry ä»ªè¡¨æ¿ä¸­çœ‹åˆ°ï¼š

### é”™è¯¯äº‹ä»¶
1. **Internal Server Error** æ¥è‡ª `/api/v1/error`
   - é”™è¯¯ç±»å‹ï¼šHTTP 500
   - åŒ…å«è¯·æ±‚ä¸Šä¸‹æ–‡ (IP, User-Agent, URL)
   - æ ‡ç­¾ï¼š`error_type=simulated`

### è‡ªå®šä¹‰äº‹ä»¶  
2. **Custom Event** æ¥è‡ª `/api/v1/custom-sentry`
   - çº§åˆ«ï¼šWarning
   - æ ‡ç­¾ï¼š`custom_event=true`
   - è‡ªå®šä¹‰ä¸Šä¸‹æ–‡æ•°æ®

### æ€§èƒ½äº‹åŠ¡
3. **create_user Transaction** æ¥è‡ª `POST /api/v1/users`
   - äº‹åŠ¡åç§°ï¼š`create_user`
   - åŒ…å«å­ spansï¼š`validate_input`, `save_to_database`
   - ç”¨æˆ·ä¸Šä¸‹æ–‡ï¼šæ¼”ç¤ºç”¨æˆ·ä¿¡æ¯

### ç”¨æˆ·ä¸Šä¸‹æ–‡
- ç”¨æˆ· IDï¼š`demo-user-123`
- ç”¨æˆ·åï¼š`demo_user`
- é‚®ç®±ï¼š`demo@example.com`

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **Secret æœªé…ç½®**
   ```text
   âš ï¸ SENTRY_DSN secret not configured, skipping real DSN test
   ```

   è§£å†³ï¼šæŒ‰ç…§ä¸Šè¿°æ­¥éª¤é…ç½® GitHub Secret

2. **æœåŠ¡å¯åŠ¨å¤±è´¥**
   - æ£€æŸ¥ä¾èµ–æ˜¯å¦æ­£ç¡®å®‰è£…
   - éªŒè¯ Go ç‰ˆæœ¬å…¼å®¹æ€§

3. **ç«¯ç‚¹æµ‹è¯•å¤±è´¥**
   - ç¡®ä¿æœåŠ¡å·²å®Œå…¨å¯åŠ¨
   - æ£€æŸ¥ç«¯å£æ˜¯å¦å†²çª

### æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

åœ¨ Actions è¿è¡Œé¡µé¢ä¸­ï¼š
1. ç‚¹å‡»å…·ä½“çš„ job
2. å±•å¼€ç›¸å…³æ­¥éª¤æŸ¥çœ‹è¯¦ç»†è¾“å‡º
3. æŸ¥çœ‹ "Generate Test Summary" è·å–æµ‹è¯•æ‘˜è¦

## è‡ªå®šä¹‰é…ç½®

ä½ å¯ä»¥ä¿®æ”¹ workflow æ–‡ä»¶æ¥ï¼š

1. **è°ƒæ•´æµ‹è¯•è¶…æ—¶æ—¶é—´**ï¼šä¿®æ”¹ `timeout` å€¼
2. **æ·»åŠ æ›´å¤šæµ‹è¯•ç«¯ç‚¹**ï¼šåœ¨ç›¸åº”æ­¥éª¤ä¸­æ·»åŠ  curl å‘½ä»¤
3. **æ›´æ”¹è§¦å‘æ¡ä»¶**ï¼šä¿®æ”¹ `on` éƒ¨åˆ†çš„è·¯å¾„å’Œåˆ†æ”¯
4. **æ·»åŠ é€šçŸ¥**ï¼šæ‰©å±• `notify-completion` job

## å®‰å…¨æ³¨æ„äº‹é¡¹

- çœŸå®çš„ SENTRY_DSN åªå­˜å‚¨åœ¨ GitHub Secrets ä¸­
- ä¸ä¼šåœ¨æ—¥å¿—ä¸­æš´éœ²æ•æ„Ÿä¿¡æ¯
- æ¨¡æ‹Ÿæ¨¡å¼ä¸ä¼šå‘é€ä»»ä½•æ•°æ®åˆ°å¤–éƒ¨æœåŠ¡
- æµ‹è¯•æ•°æ®éƒ½æ˜¯æ¼”ç¤ºæ€§è´¨çš„ï¼Œä¸åŒ…å«çœŸå®ç”¨æˆ·ä¿¡æ¯

## è´¡çŒ®æŒ‡å—

å¦‚æœéœ€è¦ä¿®æ”¹è¿™ä¸ª workflowï¼š

1. æµ‹è¯•ä½ çš„æ›´æ”¹
2. æ›´æ–°è¿™ä¸ª README
3. ç¡®ä¿æ‰€æœ‰å®‰å…¨æªæ–½ä»ç„¶æœ‰æ•ˆ
4. åœ¨ PR ä¸­è¯´æ˜ä½ çš„æ›´æ”¹
