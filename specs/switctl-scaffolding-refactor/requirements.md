# 需求文档

## 介绍

本文档概述了将switctl从服务器控制工具重构为综合性Swit框架脚手架工具的需求。重构后的switctl将作为在Swit生态系统中创建新服务和维护代码质量的主要开发工具，遵循既定的项目结构和约定。

## 需求

### 需求 1

**用户故事：** 作为开发者，我希望能够通过交互式界面生成具有标准项目布局的新服务，以便我可以自定义功能并快速开始开发遵循Swit框架约定的新微服务。

#### 验收标准

1. 当我运行 `switctl new service` 时，系统应启动美观的交互式shell界面
2. 当在交互式模式中时，系统应使用彩色输出、图标和进度条来提升用户体验
3. 当在交互式模式中时，系统应提供服务名称输入提示，并实时验证名称格式（小写，连字符分隔）
4. 当在交互式模式中时，系统应允许用户选择要包含的功能模块（数据库支持、认证、缓存、消息队列等）
5. 当在交互式模式中时，系统应允许用户选择数据库类型（MySQL、PostgreSQL、MongoDB等）
6. 当在交互式模式中时，系统应允许用户选择认证方式（JWT、OAuth2、Basic Auth等）
7. 当在交互式模式中时，系统应允许用户配置端口号和服务描述
8. 当在交互式模式中时，系统应提供预览功能，显示将要生成的文件结构
9. 当用户确认配置后，系统应显示美观的进度条和生成状态
10. 当我运行 `switctl new service <service-name>` 时，系统应支持非交互式模式，使用默认配置快速生成
11. 当生成新服务时，系统应创建遵循标准Swit布局的完整服务目录结构
12. 当生成新服务时，系统应根据用户选择的功能模块生成相应的代码和配置
13. 当生成新服务时，系统应创建具有正确包名、导入和版权头的样板文件
14. 当生成新服务时，系统应生成带有健康检查端点的HTTP和gRPC处理器模板
15. 当生成新服务时，系统应创建带有验证标签和YAML绑定的配置结构体
16. 当生成新服务时，系统应生成基于接口设计的依赖注入容器
17. 当生成新服务时，系统应创建存储库接口和基于用户选择数据库的实现
18. 当生成新服务时，系统应生成带有业务逻辑模板的服务层
19. 当生成新服务时，系统应创建遵循既定模式的adapter.go和server.go文件
20. 当生成新服务时，系统应创建带有testify套件模式的相应测试文件
21. 当生成新服务时，系统应在api/proto/swit/{service}/v1/中生成Protocol Buffer定义
22. 当生成新服务时，系统应为新服务创建Makefile目标
23. 当生成新服务时，系统应更新相关配置文件以包含新服务
24. 当生成完成时，系统应显示美观的成功消息和后续步骤指导

### 需求 2

**用户故事：** 作为开发者，我希望能够对我的服务代码运行综合检查，以便我可以在提交更改之前确保代码质量、样式合规性和测试覆盖率。

#### 验收标准

1. 当我运行 `switctl check` 时，系统应使用gofmt和golangci-lint执行代码样式验证
2. 当我运行 `switctl check` 时，系统应执行所有单元测试并报告覆盖率统计
3. 当我运行 `switctl check` 时，系统应验证测试覆盖率满足最低80%的阈值
4. 当我运行 `switctl check` 时，系统应检查正确的导入组织（标准库、第三方、内部）
5. 当我运行 `switctl check` 时，系统应验证所有Go文件都有正确的版权头
6. 当我运行 `switctl check` 时，系统应验证Protocol Buffer文件格式正确
7. 当我运行 `switctl check` 时，系统应检查生成的代码与proto定义是否最新
8. 当我运行 `switctl check` 时，系统应验证配置文件语法和结构
9. 当我运行 `switctl check` 时，系统应执行常见漏洞的安全扫描
10. 当我运行 `switctl check` 时，系统应验证所有服务实现必需的接口（健康检查、优雅关闭）
11. 当我运行 `switctl check` 时，系统应检查正确的错误处理模式
12. 当我运行 `switctl check` 时，系统应提供每个检查的通过/失败状态摘要报告
13. 当任何检查失败时，系统应以非零状态码退出并提供详细错误消息
14. 如果我指定 `--fix` 标志，系统应在可能的情况下自动修复格式和导入问题

### 需求 3

**用户故事：** 作为开发者，我希望switctl能够与现有构建系统集成，以便我可以在当前开发工作流中无缝使用它。

#### 验收标准

1. 当switctl生成文件时，系统应使用与现有服务相同的模板和模式
2. 当switctl运行检查时，系统应使用与Makefile系统相同的代码检查规则和质量标准
3. 当switctl创建新服务时，系统应与现有的buf.yaml和proto生成工作流集成
4. 当switctl执行操作时，系统应遵守现有的.gitignore模式和项目约定
5. 当switctl生成代码时，系统应使用go.mod中指定的相同依赖版本
6. 当switctl创建配置文件时，系统应遵循相同的YAML结构和验证模式
7. 当switctl生成测试时，系统应使用与现有代码相同的测试框架（testify、sqlmock）

### 需求 4

**用户故事：** 作为开发者，我希望switctl能够提供有用的反馈和指导，以便我可以了解正在执行的操作以及如何解决任何问题。

#### 验收标准

1. 当switctl执行任何操作时，系统应提供清晰的进度指示器和状态消息
2. 当switctl遇到错误时，系统应提供具体的、可操作的错误消息和建议的修复方法
3. 当switctl生成新服务时，系统应显示已创建文件的摘要和后续步骤
4. 当switctl运行检查时，系统应为每个验证步骤提供详细输出
5. 当switctl检测到问题时，系统应建议具体的命令或操作来解决它们
6. 当我运行 `switctl --help` 时，系统应提供包含示例的综合使用文档
7. 当我运行 `switctl new service --help` 时，系统应显示服务生成选项的详细帮助
8. 当我运行 `switctl check --help` 时，系统应显示可用检查选项和标志的详细帮助

### 需求 5

**用户故事：** 作为开发者，我希望能够快速生成API端点和相关代码，以便我可以高效地扩展服务功能。

#### 验收标准

1. 当我运行 `switctl generate api <endpoint-name>` 时，系统应生成完整的API端点代码（proto定义、HTTP/gRPC处理器、服务层、存储库层）
2. 当我运行 `switctl generate model <model-name>` 时，系统应生成数据模型、GORM结构体和相关的CRUD操作
3. 当我运行 `switctl generate middleware <middleware-name>` 时，系统应生成HTTP和gRPC中间件模板
4. 当生成API时，系统应自动更新proto文件并重新生成相关代码
5. 当生成代码时，系统应遵循现有的命名约定和代码结构
6. 当生成代码时，系统应包含相应的测试文件和mock实现

### 需求 6

**用户故事：** 作为开发者，我希望能够管理项目依赖和配置，以便我可以保持项目的一致性和最新状态。

#### 验收标准

1. 当我运行 `switctl deps update` 时，系统应检查并更新Go模块依赖到兼容的最新版本
2. 当我运行 `switctl deps audit` 时，系统应检查依赖的安全漏洞并提供修复建议
3. 当我运行 `switctl config validate` 时，系统应验证所有配置文件的语法和结构正确性
4. 当我运行 `switctl config template` 时，系统应生成标准的配置文件模板
5. 当更新依赖时，系统应检查是否有破坏性更改并提供迁移指导

### 需求 7

**用户故事：** 作为开发者，我希望能够通过交互式界面快速设置开发环境和运行常见任务，以便我可以提高开发效率。

#### 验收标准

1. 当我运行 `switctl init` 时，系统应启动交互式项目初始化向导，包含美观的欢迎界面
2. 当在初始化向导中时，系统应允许用户选择项目类型（单体服务、微服务集群、API网关等）
3. 当在初始化向导中时，系统应允许用户配置项目基本信息（名称、描述、作者、许可证等）
4. 当在初始化向导中时，系统应允许用户选择要包含的基础设施组件（数据库、缓存、消息队列、服务发现等）
5. 当在初始化向导中时，系统应提供项目结构预览和配置摘要
6. 当用户确认配置后，系统应创建完整的项目结构，包含所有必要的配置文件和目录
7. 当我运行 `switctl dev setup` 时，系统应显示美观的安装进度并安装所有开发依赖和工具（buf、golangci-lint等）
8. 当我运行 `switctl dev run <service>` 时，系统应启动指定服务的开发模式（热重载）并提供实时日志输出
9. 当我运行 `switctl dev test` 时，系统应运行测试并提供美观的实时反馈和进度显示
10. 当我运行 `switctl dev clean` 时，系统应显示清理进度并清理所有生成的文件和构建缓存

### 需求 8

**用户故事：** 作为开发者，我希望switctl提供美观且直观的用户界面，以便我可以享受愉快的开发体验。

#### 验收标准

1. 当switctl显示任何输出时，系统应使用彩色文本来区分不同类型的信息（成功、警告、错误、信息）
2. 当switctl执行长时间操作时，系统应显示美观的进度条和旋转器动画
3. 当switctl显示选择菜单时，系统应使用箭头键导航和高亮显示当前选项
4. 当switctl显示表格数据时，系统应使用对齐的列和边框来提高可读性
5. 当switctl显示错误信息时，系统应使用图标和颜色来突出显示，并提供清晰的解决方案
6. 当switctl显示成功信息时，系统应使用庆祝性的图标和颜色
7. 当switctl需要用户输入时，系统应提供清晰的提示和输入验证反馈
8. 当switctl显示帮助信息时，系统应使用结构化的布局和示例
9. 当switctl在终端中运行时，系统应自动检测终端能力并调整输出格式
10. 当switctl显示长文本时，系统应支持分页和搜索功能

### 需求 9

**用户故事：** 作为开发者，我希望switctl具有高度的扩展性和可维护性，以便随着Swit框架的快速发展可以轻松适应变化和添加新功能。

#### 验收标准

1. 当实现switctl命令时，系统应使用cobra CLI框架以保持一致的命令结构和易于扩展的架构
2. 当添加新功能时，系统应遵循与其他Swit服务相同的依赖注入模式和接口设计原则
3. 当创建模板时，系统应使用支持热重载和动态修改的模板引擎（如Go templates或嵌入式Lua）
4. 当实现检查时，系统应使用插件架构，允许通过配置文件动态加载新的验证规则
5. 当switctl处理文件时，系统应使用抽象的文件系统接口，支持不同的存储后端
6. 当switctl与外部工具交互时，系统应将这些交互抽象在可配置的适配器接口后面
7. 当需要switctl配置时，系统应使用分层配置系统，支持全局、项目和用户级别的配置覆盖
8. 当添加新命令时，系统应支持插件发现机制，自动加载指定目录中的插件
9. 当框架API发生变化时，系统应提供版本兼容性检查和自动迁移功能
10. 当模板需要更新时，系统应支持模板版本管理和在线更新机制
11. 当新的代码生成需求出现时，系统应提供可扩展的代码生成器框架
12. 当需要集成新工具时，系统应提供标准化的工具集成接口

### 需求 10

**用户故事：** 作为Swit框架维护者，我希望switctl能够适应框架的快速迭代，以便工具始终与框架保持同步。

#### 验收标准

1. 当Swit框架版本更新时，系统应能够检测版本兼容性并提供升级指导
2. 当新的最佳实践出现时，系统应能够通过配置更新来采用新的代码模式
3. 当框架结构发生变化时，系统应提供迁移工具来更新现有项目
4. 当新的依赖或工具被引入时，系统应能够通过插件系统无缝集成
5. 当代码规范发生变化时，系统应能够更新检查规则而无需重新编译
6. 当新的项目类型需要支持时，系统应能够通过模板扩展来支持
7. 当需要支持新的编程语言或技术栈时，系统应提供语言适配器接口
8. 当社区贡献新功能时，系统应提供标准化的贡献和集成流程