# Swit v0.9.0 å‘å¸ƒè¯´æ˜

## ğŸ‰ é‡å¤§æ›´æ–°ï¼šSaga åˆ†å¸ƒå¼äº‹åŠ¡ç³»ç»Ÿæ­£å¼å‘å¸ƒ

æˆ‘ä»¬éå¸¸é«˜å…´åœ°å®£å¸ƒ Swit v0.9.0 æ­£å¼å‘å¸ƒï¼è¿™æ˜¯ä¸€ä¸ªé‡Œç¨‹ç¢‘ç‰ˆæœ¬ï¼Œå¼•å…¥äº†å®Œæ•´çš„ **Saga åˆ†å¸ƒå¼äº‹åŠ¡ç³»ç»Ÿ**ï¼Œä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ä¼ä¸šçº§çš„åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†èƒ½åŠ›ã€‚

## ğŸ“… å‘å¸ƒä¿¡æ¯

- **ç‰ˆæœ¬**: v0.9.0
- **å‘å¸ƒæ—¥æœŸ**: 2025-10-28
- **Go ç‰ˆæœ¬è¦æ±‚**: 1.23.12+
- **å…¼å®¹æ€§**: å®Œå…¨å‘åå…¼å®¹ v0.8.x

## âœ¨ æ ¸å¿ƒäº®ç‚¹

### 1. å®Œæ•´çš„ Saga åˆ†å¸ƒå¼äº‹åŠ¡ç³»ç»Ÿ

Saga æ¨¡å¼æ˜¯å¤„ç†å¾®æœåŠ¡åˆ†å¸ƒå¼äº‹åŠ¡çš„æœ€ä½³å®è·µã€‚Swit v0.9.0 æä¾›äº†åŠŸèƒ½å®Œæ•´ã€ç”Ÿäº§å°±ç»ªçš„ Saga å®ç°ã€‚

#### ğŸ”§ æ ¸å¿ƒèƒ½åŠ›

- **å¤šç§æ‰§è¡Œæ¨¡å¼**
  - **ç¼–æ’æ¨¡å¼ï¼ˆOrchestrationï¼‰**: ä¸­å¿ƒåŒ–çš„äº‹åŠ¡åè°ƒï¼Œé€‚åˆå¤æ‚çš„ä¸šåŠ¡æµç¨‹
  - **ååŒæ¨¡å¼ï¼ˆChoreographyï¼‰**: å»ä¸­å¿ƒåŒ–çš„äº‹ä»¶é©±åŠ¨ï¼Œé€‚åˆæ¾è€¦åˆçš„æœåŠ¡
  - **æ··åˆæ¨¡å¼ï¼ˆHybridï¼‰**: æ™ºèƒ½é€‰æ‹©æœ€ä¼˜æ‰§è¡Œæ¨¡å¼

- **å¯é æ€§ä¿éšœ**
  - æŒ‡æ•°é€€é¿ã€å›ºå®šå»¶è¿Ÿã€çº¿æ€§é€€é¿ç­‰å¤šç§é‡è¯•ç­–ç•¥
  - çµæ´»çš„è¡¥å¿ç­–ç•¥ï¼ˆé¡ºåºã€å¹¶è¡Œã€è‡ªå®šä¹‰ï¼‰
  - è‡ªåŠ¨è¶…æ—¶æ£€æµ‹å’Œæ¢å¤
  - æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDLQï¼‰å¤„ç†å¤±è´¥æ¶ˆæ¯
  - äº‹åŠ¡æ€§æ¶ˆæ¯å‘é€ä¿è¯

- **å¤šå­˜å‚¨åç«¯**
  - PostgreSQLï¼ˆç”Ÿäº§æ¨èï¼‰
  - MySQL
  - SQLiteï¼ˆå¼€å‘æµ‹è¯•ï¼‰
  - å†…å­˜å­˜å‚¨ï¼ˆå•å…ƒæµ‹è¯•ï¼‰

#### ğŸ“ Saga DSL - å£°æ˜å¼å·¥ä½œæµå®šä¹‰

ä½¿ç”¨äººç±»å¯è¯»çš„ YAML æ ¼å¼å®šä¹‰å¤æ‚çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼š

```yaml
saga:
  id: order-processing
  name: è®¢å•å¤„ç†
  mode: orchestration
  timeout: 5m

steps:
  - id: create-order
    name: åˆ›å»ºè®¢å•
    action: http
    url: http://order-service/orders
    compensation:
      action: http
      url: http://order-service/orders/{order_id}/cancel
    
  - id: reserve-inventory
    name: é¢„ç•™åº“å­˜
    action: http
    url: http://inventory-service/reserve
    compensation:
      action: http
      url: http://inventory-service/release
```

**é…å¥—å·¥å…·ï¼š**
- `saga-dsl-validate` - DSL é…ç½®éªŒè¯
- `saga-migrate` - æ•°æ®åº“è¿ç§»
- ä»£ç ç”Ÿæˆå™¨ - è‡ªåŠ¨ç”Ÿæˆ Go ä»£ç 

### 2. ä¼ä¸šçº§å®‰å…¨ç‰¹æ€§

#### ğŸ”’ è®¤è¯ä¸æˆæƒ

- **è®¤è¯ä¸­é—´ä»¶**: æ”¯æŒ JWT å’Œ API Key è®¤è¯
- **RBAC æƒé™æ§åˆ¶**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
- **ACL è®¿é—®æ§åˆ¶åˆ—è¡¨**: ç»†ç²’åº¦çš„æƒé™ç®¡ç†

#### ğŸ›¡ï¸ æ•°æ®ä¿æŠ¤

- **æ•æ„Ÿæ•°æ®åŠ å¯†**: AES-256-GCM åŠ å¯†ç®—æ³•
- **å­—æ®µçº§åŠ å¯†**: æ”¯æŒå¯¹ç‰¹å®šå­—æ®µè¿›è¡ŒåŠ å¯†
- **å®¡è®¡æ—¥å¿—**: å®Œæ•´çš„æ“ä½œè¿½è¸ªå’Œå®¡è®¡æŠ¥å‘Š

### 3. å…¨é¢çš„ç›‘æ§ä¸å¯è§‚æµ‹æ€§

#### ğŸ“Š æŒ‡æ ‡æ”¶é›†

- **Prometheus é›†æˆ**: æ”¶é›† 40+ å…³é”®æ€§èƒ½æŒ‡æ ‡
  - Saga æ‰§è¡Œæ¬¡æ•°ã€æˆåŠŸç‡ã€å¤±è´¥ç‡
  - æ­¥éª¤æ‰§è¡Œæ—¶é•¿ã€é‡è¯•æ¬¡æ•°
  - è¡¥å¿æ‰§è¡Œç»Ÿè®¡
  - å­˜å‚¨å’Œæ¶ˆæ¯ä¼ é€’æ€§èƒ½

- **è‡ªå®šä¹‰æŒ‡æ ‡**: æ”¯æŒä¸šåŠ¡æŒ‡æ ‡å®šä¹‰å’Œæ”¶é›†

#### ğŸ” åˆ†å¸ƒå¼è¿½è¸ª

- **OpenTelemetry é›†æˆ**: æ ‡å‡†çš„è¿½è¸ªåè®®
- **Jaeger/Zipkin æ”¯æŒ**: å¯è§†åŒ–è¿½è¸ªæ•°æ®
- **ä¸Šä¸‹æ–‡ä¼ æ’­**: è·¨æœåŠ¡çš„å®Œæ•´è°ƒç”¨é“¾è¿½è¸ª

#### ğŸ’Š å¥åº·æ£€æŸ¥

- å®æ—¶ç›‘æ§ Saga ç³»ç»Ÿå¥åº·çŠ¶æ€
- è‡ªåŠ¨å‘Šè­¦å’Œé€šçŸ¥é›†æˆ

### 4. Saga Dashboard - å¯è§†åŒ–ç®¡ç†åå°

åŠŸèƒ½å®Œæ•´çš„ Web ç®¡ç†ç•Œé¢ï¼Œæä¾›ç›´è§‚çš„è¿ç»´ä½“éªŒã€‚

#### æ ¸å¿ƒåŠŸèƒ½

- **Saga ç®¡ç†**
  - å®æ—¶æŸ¥çœ‹æ‰€æœ‰ Saga å®ä¾‹çŠ¶æ€
  - æŸ¥è¯¢ Saga æ‰§è¡Œå†å²å’Œè¯¦æƒ…
  - æ‰‹åŠ¨å–æ¶ˆæˆ–é‡è¯• Saga
  - æµç¨‹å¯è§†åŒ–å›¾è¡¨

- **ç›‘æ§å¤§ç›˜**
  - å®æ—¶æ€§èƒ½æŒ‡æ ‡å±•ç¤º
  - å‘Šè­¦é€šçŸ¥
  - è¶‹åŠ¿åˆ†æå›¾è¡¨

- **ç°ä»£åŒ– UI**
  - å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯
  - WebSocket å®æ—¶æ•°æ®æ¨é€
  - äº¤äº’å¼å¯è§†åŒ–å›¾è¡¨

### 5. ä¸°å¯Œçš„ç¤ºä¾‹åº”ç”¨

æä¾› 4 ä¸ªå®Œæ•´çš„ç”Ÿäº§çº§ç¤ºä¾‹ï¼Œå±•ç¤ºæœ€ä½³å®è·µï¼š

#### ğŸ“¦ è®¢å•å¤„ç† Saga
å®Œæ•´çš„ç”µå•†è®¢å•å¤„ç†æµç¨‹ï¼ŒåŒ…å«è®¢å•åˆ›å»ºã€åº“å­˜é¢„ç•™ã€æ”¯ä»˜å¤„ç†å’Œè®¢å•ç¡®è®¤ã€‚

#### ğŸ’³ æ”¯ä»˜å¤„ç† Saga
è·¨è´¦æˆ·èµ„é‡‘è½¬è´¦åœºæ™¯ï¼Œå±•ç¤ºå¼ºä¸€è‡´æ€§è¦æ±‚ä¸‹çš„ Saga å®ç°ã€‚

#### ğŸ“Š åº“å­˜ç®¡ç† Saga
å¤šä»“åº“åº“å­˜åè°ƒï¼Œå±•ç¤ºå¹¶è¡Œæ­¥éª¤å’Œè¡¥å¿ç­–ç•¥ã€‚

#### ğŸ‘¤ ç”¨æˆ·æ³¨å†Œ Saga
ç”¨æˆ·æ³¨å†Œå’Œåˆå§‹åŒ–æµç¨‹ï¼Œå±•ç¤ºç®€å•çš„ Saga ä½¿ç”¨ã€‚

**æ¯ä¸ªç¤ºä¾‹åŒ…å«ï¼š**
- å®Œæ•´çš„æºä»£ç å®ç°
- Docker Compose ä¸€é”®å¯åŠ¨ç¯å¢ƒ
- ç«¯åˆ°ç«¯æµ‹è¯•
- è¯¦ç»†çš„æ–‡æ¡£è¯´æ˜

## ğŸ“š å®Œå–„çš„æ–‡æ¡£ä½“ç³»

### ç”¨æˆ·æ–‡æ¡£
- **å¿«é€Ÿå¼€å§‹**: 10 åˆ†é’Ÿä¸Šæ‰‹ Saga
- **ç”¨æˆ·æŒ‡å—**: æ ¸å¿ƒæ¦‚å¿µå’Œä½¿ç”¨æ–¹æ³•
- **API å‚è€ƒ**: å®Œæ•´çš„ API æ–‡æ¡£
- **æ•™ç¨‹**: åˆ†æ­¥æ•™ç¨‹å’Œæœ€ä½³å®è·µ

### å¼€å‘è€…æ–‡æ¡£
- **å¼€å‘è€…æŒ‡å—**: æ¶æ„è®¾è®¡å’Œæ‰©å±•å¼€å‘
- **DSL å‚è€ƒ**: DSL è¯­æ³•å®Œæ•´è¯´æ˜
- **å®‰å…¨æŒ‡å—**: å®‰å…¨æœ€ä½³å®è·µ
- **ç›‘æ§æŒ‡å—**: ç›‘æ§å’Œæ•…éšœæ’æŸ¥

### éƒ¨ç½²æ–‡æ¡£
- **éƒ¨ç½²æŒ‡å—**: ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æœ€ä½³å®è·µ
- **é…ç½®å‚è€ƒ**: å®Œæ•´çš„é…ç½®é€‰é¡¹è¯´æ˜
- **è¿ç»´æ‰‹å†Œ**: æ—¥å¸¸è¿ç»´æ“ä½œæŒ‡å—

### æ–‡æ¡£ç½‘ç«™
- **åœ¨çº¿æ–‡æ¡£**: https://innovationmech.github.io/swit/
- **å¤šè¯­è¨€æ”¯æŒ**: ä¸­æ–‡å’Œè‹±æ–‡æ–‡æ¡£
- **äº¤äº’å¼ç¤ºä¾‹**: å¯è¿è¡Œçš„ä»£ç ç¤ºä¾‹

## ğŸ§ª æµ‹è¯•ä¸è´¨é‡

### æµ‹è¯•è¦†ç›–ç‡å¤§å¹…æå‡

- **Saga æ ¸å¿ƒåŒ…**: 96.0% è¦†ç›–ç‡ï¼ˆä» 70.4% æå‡ï¼‰
- **ç›‘æ§åŒ…**: 77% è¦†ç›–ç‡ï¼ˆä» 71.5% æå‡ï¼‰
- **æ•´ä½“è¦†ç›–ç‡**: 85%+ è¦†ç›–ç‡

### å®Œæ•´çš„æµ‹è¯•å¥—ä»¶

- **å•å…ƒæµ‹è¯•**: è¦†ç›–æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½
- **é›†æˆæµ‹è¯•**: ç«¯åˆ°ç«¯åœºæ™¯æµ‹è¯•
- **æ€§èƒ½åŸºå‡†æµ‹è¯•**: é‡åŒ–æ€§èƒ½æŒ‡æ ‡
- **æ··æ²Œæµ‹è¯•**: éªŒè¯ç³»ç»Ÿåœ¨å„ç§å¼‚å¸¸æƒ…å†µä¸‹çš„ç¨³å®šæ€§
- **DSL æµ‹è¯•**: éªŒè¯ DSL é…ç½®çš„æ­£ç¡®æ€§

### CI/CD å¢å¼º

- è‡ªåŠ¨åŒ–æµ‹è¯•å’Œæ„å»ºæµç¨‹
- ä»£ç è¦†ç›–ç‡æŠ¥å‘Šï¼ˆCodecovï¼‰
- ä»£ç è´¨é‡æ£€æŸ¥ï¼ˆLintingï¼‰
- å®‰å…¨æ‰«æï¼ˆCodeQLï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
go get github.com/innovationmech/swit@v0.9.0
```

### åˆ›å»ºç¬¬ä¸€ä¸ª Saga

```go
package main

import (
    "context"
    "time"
    "github.com/innovationmech/swit/pkg/saga"
)

func main() {
    // 1. åˆ›å»º Saga å®šä¹‰
    def := saga.NewDefinitionBuilder().
        SetID("order-processing").
        SetName("è®¢å•å¤„ç†").
        AddStep(NewCreateOrderStep()).
        AddStep(NewReserveInventoryStep()).
        AddStep(NewProcessPaymentStep()).
        SetTimeout(5 * time.Minute).
        Build()
    
    // 2. åˆ›å»ºåè°ƒå™¨
    coordinator, err := saga.NewCoordinator(
        saga.WithStorage(storage),
        saga.WithMessaging(publisher),
    )
    if err != nil {
        panic(err)
    }
    
    // 3. æ‰§è¡Œ Saga
    instance, err := coordinator.Execute(context.Background(), def, orderData)
    if err != nil {
        panic(err)
    }
    
    // 4. ç­‰å¾…å®Œæˆ
    result := coordinator.Wait(context.Background(), instance.ID)
    if result.State == saga.StateCompleted {
        println("è®¢å•å¤„ç†æˆåŠŸ!")
    }
}
```

### ä½¿ç”¨ DSL æ–¹å¼

```yaml
# order-saga.yaml
saga:
  id: order-processing
  name: è®¢å•å¤„ç†
  mode: orchestration
  timeout: 5m

steps:
  - id: create-order
    name: åˆ›å»ºè®¢å•
    action: http
    url: http://order-service/orders
    method: POST
    
  - id: reserve-inventory
    name: é¢„ç•™åº“å­˜
    action: http
    url: http://inventory-service/reserve
    
  - id: process-payment
    name: å¤„ç†æ”¯ä»˜
    action: http
    url: http://payment-service/pay
```

```bash
# éªŒè¯é…ç½®
saga-dsl-validate order-saga.yaml

# è¿è¡Œ Saga
./bin/swit-serve --saga-config order-saga.yaml
```

## ğŸ“¦ å®Œæ•´ç¤ºä¾‹

å…‹éš†ä»“åº“å¹¶è¿è¡Œç¤ºä¾‹ï¼š

```bash
git clone https://github.com/innovationmech/swit.git
cd swit

# å¯åŠ¨ä¾èµ–æœåŠ¡
docker-compose -f examples/saga-examples/docker-compose.yml up -d

# è¿è¡Œè®¢å•å¤„ç†ç¤ºä¾‹
cd pkg/saga/examples
go run order_saga.go

# æˆ–ä½¿ç”¨æä¾›çš„è„šæœ¬
./run.sh order
```

## ğŸ”„ è¿ç§»æŒ‡å—

### ä» v0.8.x å‡çº§

**å¥½æ¶ˆæ¯**: v0.9.0 å®Œå…¨å‘åå…¼å®¹ v0.8.xï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç ï¼

å¦‚æœæ‚¨æƒ³ä½¿ç”¨æ–°çš„ Saga åŠŸèƒ½ï¼š

1. **æ›´æ–°ä¾èµ–**
   ```bash
   go get -u github.com/innovationmech/swit@v0.9.0
   ```

2. **å®‰è£…æ•°æ®åº“**ï¼ˆå¦‚éœ€ä½¿ç”¨ Sagaï¼‰
   ```bash
   # PostgreSQL (æ¨è)
   docker run -d -p 5432:5432 \
     -e POSTGRES_DB=saga \
     -e POSTGRES_PASSWORD=password \
     postgres:16
   ```

3. **è¿è¡Œè¿ç§»**
   ```bash
   saga-migrate -dsn "postgres://postgres:password@localhost/saga" -action migrate
   ```

4. **é…ç½® Saga**
   åœ¨æ‚¨çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š
   ```yaml
   saga:
     enabled: true
     storage:
       type: postgres
       dsn: "postgres://postgres:password@localhost/saga"
     messaging:
       broker: nats
       url: "nats://localhost:4222"
   ```

### æ— ç ´åæ€§å˜æ›´

- âœ… æ‰€æœ‰ç°æœ‰ API ä¿æŒä¸å˜
- âœ… é…ç½®æ ¼å¼å…¼å®¹
- âœ… ä¾èµ–ç‰ˆæœ¬å…¼å®¹

## ğŸ› Bug ä¿®å¤

- ä¿®å¤ CI æ„å»ºç¼ºå°‘ proto ç”Ÿæˆçš„é—®é¢˜ (#756)
- ä¿®å¤å¤šä¸ªä¸ç¨³å®šçš„æµ‹è¯•ç”¨ä¾‹ (#758, #740, #747, #736)
- ä¿®å¤ CodeQL å®‰å…¨å‘Šè­¦ (#745)
- ä¿®æ­£ Saga é‡è¯•ç­–ç•¥ç±»å‹åç§° (#763)
- ä¿®å¤ MockStateStorage çŠ¶æ€æŒä¹…åŒ–é—®é¢˜ (#743)

## âš¡ æ€§èƒ½æ”¹è¿›

- æ‰¹é‡äº‹ä»¶å‘å¸ƒä¼˜åŒ– - æé«˜ååé‡ 50%
- è¿æ¥æ± ä¼˜åŒ– - æé«˜å¹¶å‘èƒ½åŠ› 30%
- å¼‚æ­¥è¡¥å¿ - é™ä½å»¶è¿Ÿ 40%

## ğŸ“Š åŸºå‡†æµ‹è¯•ç»“æœ

```
BenchmarkSagaExecution/orchestration-8         10000    115234 ns/op
BenchmarkSagaExecution/choreography-8           8000    142567 ns/op
BenchmarkStateStorage/save-8                  100000     11234 ns/op
BenchmarkStateStorage/get-8                   200000      5678 ns/op
BenchmarkEventPublisher/publish-8             150000      8901 ns/op
```

## ğŸ› ï¸ æ–°å¢å·¥å…·

- `saga-migrate` - Saga æ•°æ®åº“è¿ç§»å·¥å…·
- `saga-dsl-validate` - DSL é…ç½®éªŒè¯å·¥å…·
- `swit-docgen` - æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆå·¥å…·

## ğŸ”— èµ„æºé“¾æ¥

- **å®˜æ–¹æ–‡æ¡£**: https://innovationmech.github.io/swit/
- **GitHub ä»“åº“**: https://github.com/innovationmech/swit
- **ç¤ºä¾‹ä»£ç **: https://github.com/innovationmech/swit/tree/master/pkg/saga/examples
- **é—®é¢˜åé¦ˆ**: https://github.com/innovationmech/swit/issues
- **è®¨è®ºåŒº**: https://github.com/innovationmech/swit/discussions

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰ä¸ºæœ¬ç‰ˆæœ¬åšå‡ºè´¡çŒ®çš„å¼€å‘è€…å’Œç¤¾åŒºæˆå‘˜ï¼ç‰¹åˆ«æ„Ÿè°¢ä»¥ä¸‹æ–¹é¢çš„è´¡çŒ®ï¼š

- Saga åˆ†å¸ƒå¼äº‹åŠ¡ç³»ç»Ÿçš„å®Œæ•´å®ç°
- å…¨é¢çš„æµ‹è¯•å¥—ä»¶å’Œæ–‡æ¡£ä½“ç³»
- ç¤ºä¾‹åº”ç”¨å’Œæœ€ä½³å®è·µ
- Bug ä¿®å¤å’Œæ€§èƒ½ä¼˜åŒ–

## ğŸš§ ä¸‹ä¸€æ­¥è®¡åˆ’

æˆ‘ä»¬æ­£åœ¨ä¸º **v1.0.0** åšæœ€åçš„å‡†å¤‡ï¼Œè®¡åˆ’åŒ…æ‹¬ï¼š

- âœ… å®Œå–„ Saga æ–‡æ¡£ï¼ˆå·²å®Œæˆï¼‰
- âœ… å…¨é¢çš„æµ‹è¯•è¦†ç›–ï¼ˆå·²å®Œæˆï¼‰
- ğŸ”„ ç¤¾åŒºåé¦ˆæ”¶é›†ï¼ˆè¿›è¡Œä¸­ï¼‰
- ğŸ“ æ›´æ–° README å’Œé¡¹ç›®æ–‡æ¡£ï¼ˆå³å°†å¼€å§‹ï¼‰
- ğŸ¯ å‘å¸ƒ v1.0.0 æ­£å¼ç‰ˆï¼ˆé¢„è®¡ 2025-11 æœˆï¼‰

## ğŸ’¬ åé¦ˆä¸æ”¯æŒ

å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜æˆ–æœ‰ä»»ä½•å»ºè®®ï¼Œæ¬¢è¿ï¼š

- æäº¤ Issue: https://github.com/innovationmech/swit/issues
- å‚ä¸è®¨è®º: https://github.com/innovationmech/swit/discussions
- è´¡çŒ®ä»£ç : https://github.com/innovationmech/swit/pulls

---

**Happy Coding with Swit! ğŸ‰**

Swit å›¢é˜Ÿ
2025-10-28

