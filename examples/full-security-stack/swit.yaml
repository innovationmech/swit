# Full Security Stack Example Configuration
# This configuration integrates OAuth2, OPA, mTLS, audit logging, and security metrics

service_name: "full-security-stack-example"
shutdown_timeout: "30s"

# HTTP Configuration
http:
  enabled: true
  port: "8080"
  enable_ready: true
  read_timeout: "30s"
  write_timeout: "30s"
  idle_timeout: "60s"
  
  # mTLS Configuration (uncomment to enable)
  # tls:
  #   enabled: true
  #   cert_file: "certs/server.crt"
  #   key_file: "certs/server.key"
  #   ca_files:
  #     - "certs/ca.crt"
  #   client_auth: "require_and_verify"
  #   min_version: "TLS1.2"
  #   max_version: "TLS1.3"

# gRPC Configuration (disabled for this example)
grpc:
  enabled: false

# OAuth2/OIDC Configuration
oauth2:
  enabled: true
  
  # Provider: keycloak, auth0, google, github, or custom
  provider: "keycloak"
  
  # OAuth2 Client Credentials
  client_id: "swit-example"
  client_secret: "swit-example-secret"
  
  # Redirect URL for OAuth2 callback
  redirect_url: "http://localhost:8080/api/v1/public/callback"
  
  # OAuth2 Scopes
  scopes:
    - "openid"
    - "profile"
    - "email"
  
  # OIDC Discovery
  issuer_url: "http://localhost:8081/realms/swit"
  use_discovery: true
  
  # HTTP Timeout
  http_timeout: "30s"
  
  # JWT Token Validation Configuration
  jwt:
    signing_method: "RS256"
    clock_skew: "30s"
    audience: "swit-example"
    issuer: "http://localhost:8081/realms/swit"
  
  # Token Cache Configuration
  cache:
    enabled: true
    type: "memory"
    ttl: "5m"
    max_entries: 1000
    cleanup_interval: "10m"

# OPA (Open Policy Agent) Configuration
opa:
  # OPA mode: "embedded" or "remote"
  mode: "embedded"
  
  # Embedded OPA configuration
  embedded:
    policy_dir: "./policies"
    watch_enabled: true
    watch_interval: "30s"
  
  # Remote OPA configuration (used when mode is "remote")
  remote:
    url: "http://localhost:8181"
    timeout: "5s"
    health_check:
      enabled: true
      interval: "30s"
      timeout: "5s"
      failure_threshold: 3
      success_threshold: 1
  
  # Default decision path (e.g., "rbac/allow" or "abac/allow")
  default_decision_path: "rbac/allow"
  
  # Cache configuration
  cache:
    enabled: true
    max_size: 1000
    ttl: "5m"
  
  # Policy validation on startup
  validate_on_startup: true

# Security Configuration
security:
  enabled: true
  
  # Audit logging
  audit:
    enabled: true
    log_file: ""  # Empty for stdout
    include_body: false
    include_headers: true
    
  # Security metrics
  metrics:
    enabled: true
    namespace: "swit"
    subsystem: "security"

# Middleware Configuration
middleware:
  enable_cors: true
  enable_logging: true
  enable_recovery: true
  
  # CORS Configuration
  cors:
    allow_origins:
      - "http://localhost:8080"
      - "http://localhost:3000"
      - "http://localhost:8081"
    allow_methods:
      - "GET"
      - "POST"
      - "PUT"
      - "DELETE"
      - "OPTIONS"
    allow_headers:
      - "Authorization"
      - "Content-Type"
      - "X-Request-ID"
    expose_headers:
      - "Content-Length"
      - "X-Request-ID"
    allow_credentials: true
    max_age: "12h"
  
  # OPA middleware configuration
  opa:
    enabled: true
    skip_paths:
      - "/api/v1/health"
      - "/api/v1/public/"
      - "/metrics"
      - "/readiness"
      - "/liveness"
    error_response:
      evaluation_error:
        status: 500
        message: "Internal server error"
      access_denied:
        status: 403
        message: "Access denied"

# Service Discovery (disabled for this example)
discovery:
  enabled: false

# Prometheus Metrics
prometheus:
  enabled: true
  endpoint: "/metrics"
  namespace: "swit"
  subsystem: "full_security_stack"
  labels:
    service: "full-security-stack-example"
    version: "v1"

# Health Check Configuration
health:
  enabled: true
  endpoints:
    liveness: "/liveness"
    readiness: "/readiness"
  checks:
    opa: true
    oauth2: true

# Logging Configuration
logging:
  level: "info"
  format: "json"
  colored: false
  log_decisions: true
  log_evaluation: false

# Example-specific configuration
example:
  # Policy type to use: "rbac" or "abac"
  policy_type: "rbac"
  
  # Predefined documents for demonstration
  documents:
    - id: "doc-1"
      title: "Public Announcement"
      content: "This is a public document"
      owner: "system"
      classification: "public"
    
    - id: "doc-2"
      title: "Engineering Specs"
      content: "Internal engineering specifications"
      owner: "alice"
      classification: "internal"
    
    - id: "doc-3"
      title: "Financial Report Q4"
      content: "Confidential financial data"
      owner: "bob"
      classification: "confidential"
    
    - id: "doc-4"
      title: "Strategic Plan 2025"
      content: "Restricted strategic planning document"
      owner: "admin"
      classification: "restricted"
  
  # Predefined users for demonstration
  users:
    - username: "alice"
      roles:
        - "admin"
    
    - username: "bob"
      roles:
        - "editor"
    
    - username: "charlie"
      roles:
        - "viewer"
    
    - username: "dave"
      roles:
        - "guest"

# Development Configuration
development:
  enabled: true
  debug_endpoints: true
  request_logging: true
  policy_reload_endpoint: true

# Production overrides (uncomment for production)
# production:
#   http:
#     port: "8443"
#     tls:
#       enabled: true
#       cert_file: "/etc/ssl/certs/server.crt"
#       key_file: "/etc/ssl/private/server.key"
#       ca_files:
#         - "/etc/ssl/certs/ca.crt"
#       client_auth: "require_and_verify"
#   
#   opa:
#     mode: "remote"
#     remote:
#       url: "http://opa-server:8181"
#       timeout: "3s"
#     cache:
#       enabled: true
#       max_size: 10000
#       ttl: "10m"
#   
#   logging:
#     level: "warn"
#     format: "json"
#     colored: false
#   
#   security:
#     audit:
#       enabled: true
#       log_file: "/var/log/swit/audit.log"
#   
#   development:
#     enabled: false

