ğŸ‰ Swit å¾®æœåŠ¡å¹³å°å·²æˆåŠŸéƒ¨ç½²ï¼

ğŸ“‹ éƒ¨ç½²ä¿¡æ¯:
  å‘½åç©ºé—´: {{ include "swit.namespace" . }}
  å‘å¸ƒåç§°: {{ .Release.Name }}
  Chart ç‰ˆæœ¬: {{ .Chart.Version }}
  åº”ç”¨ç¨‹åºç‰ˆæœ¬: {{ .Chart.AppVersion }}

ğŸ“¦ å·²éƒ¨ç½²çš„æœåŠ¡:

{{- if .Values.mysql.enabled }}
ğŸ—„ï¸  MySQL æ•°æ®åº“:
  - å†…éƒ¨åœ°å€: {{ include "swit.mysql.fullname" . }}-service:{{ .Values.mysql.service.port }}
  - çŠ¶æ€: kubectl get pods -n {{ include "swit.namespace" . }} -l app.kubernetes.io/component=database
{{- end }}

{{- if .Values.consul.enabled }}
ğŸ” Consul æœåŠ¡å‘ç°:
  - å†…éƒ¨åœ°å€: {{ include "swit.consul.fullname" . }}-service:{{ .Values.consul.service.httpPort }}
  {{- if .Values.consul.ui.enabled }}
  {{- if eq .Values.consul.ui.service.type "NodePort" }}
  - UI è®¿é—®: http://<NODE-IP>:{{ .Values.consul.ui.service.nodePort }}
  {{- else if eq .Values.consul.ui.service.type "LoadBalancer" }}
  - UI è®¿é—®: http://<EXTERNAL-IP>:{{ .Values.consul.service.httpPort }}
  {{- end }}
  {{- end }}
  - çŠ¶æ€: kubectl get pods -n {{ include "swit.namespace" . }} -l app.kubernetes.io/component=service-discovery
{{- end }}

{{- if .Values.switAuth.enabled }}
ğŸ” è®¤è¯æœåŠ¡ (swit-auth):
  - å†…éƒ¨åœ°å€: {{ include "swit.auth.fullname" . }}-service:{{ .Values.switAuth.service.port }}
  {{- if .Values.switAuth.external.enabled }}
  {{- if eq .Values.switAuth.external.service.type "NodePort" }}
  - å¤–éƒ¨è®¿é—®: http://<NODE-IP>:{{ .Values.switAuth.external.service.nodePort }}
  {{- else if eq .Values.switAuth.external.service.type "LoadBalancer" }}
  - å¤–éƒ¨è®¿é—®: http://<EXTERNAL-IP>:{{ .Values.switAuth.service.port }}
  {{- end }}
  {{- end }}
  - å‰¯æœ¬æ•°: {{ .Values.switAuth.replicaCount }}
  - çŠ¶æ€: kubectl get pods -n {{ include "swit.namespace" . }} -l app.kubernetes.io/component=authentication
{{- end }}

{{- if .Values.switServe.enabled }}
ğŸš€ ä¸»è¦æœåŠ¡ (swit-serve):
  - å†…éƒ¨åœ°å€: {{ include "swit.serve.fullname" . }}-service:{{ .Values.switServe.service.port }}
  {{- if .Values.switServe.external.enabled }}
  {{- if eq .Values.switServe.external.service.type "NodePort" }}
  - å¤–éƒ¨è®¿é—®: http://<NODE-IP>:{{ .Values.switServe.external.service.nodePort }}
  {{- else if eq .Values.switServe.external.service.type "LoadBalancer" }}
  - å¤–éƒ¨è®¿é—®: http://<EXTERNAL-IP>:{{ .Values.switServe.service.port }}
  {{- end }}
  {{- end }}
  - å‰¯æœ¬æ•°: {{ .Values.switServe.replicaCount }}
  - çŠ¶æ€: kubectl get pods -n {{ include "swit.namespace" . }} -l app.kubernetes.io/component=api-server
{{- end }}

{{- if .Values.ingress.enabled }}
ğŸŒ Ingress è·¯ç”±:
{{- range .Values.ingress.hosts }}
  - ä¸»æœº: {{ .host }}
{{- range .paths }}
    è·¯å¾„: {{ .path }} â†’ {{ .backend.service }}
{{- end }}
{{- end }}
  è®¿é—®æ–¹å¼: 
  - HTTP: http://{{ (index .Values.ingress.hosts 0).host }}
  {{- if .Values.ingress.tls }}
  - HTTPS: https://{{ (index .Values.ingress.hosts 0).host }}
  {{- end }}
{{- end }}

ğŸ”§ ç®¡ç†å‘½ä»¤:

1. æŸ¥çœ‹æ‰€æœ‰èµ„æºçŠ¶æ€:
   kubectl get all -n {{ include "swit.namespace" . }}

2. æŸ¥çœ‹æœåŠ¡æ—¥å¿—:
   # è®¤è¯æœåŠ¡æ—¥å¿—
   kubectl logs -n {{ include "swit.namespace" . }} -l app.kubernetes.io/component=authentication --tail=100 -f
   
   # ä¸»è¦æœåŠ¡æ—¥å¿—
   kubectl logs -n {{ include "swit.namespace" . }} -l app.kubernetes.io/component=api-server --tail=100 -f

3. è¿›å…¥æœåŠ¡å®¹å™¨:
   # è®¤è¯æœåŠ¡
   kubectl exec -n {{ include "swit.namespace" . }} -it $(kubectl get pod -n {{ include "swit.namespace" . }} -l app.kubernetes.io/component=authentication -o jsonpath='{.items[0].metadata.name}') -- /bin/bash
   
   # ä¸»è¦æœåŠ¡
   kubectl exec -n {{ include "swit.namespace" . }} -it $(kubectl get pod -n {{ include "swit.namespace" . }} -l app.kubernetes.io/component=api-server -o jsonpath='{.items[0].metadata.name}') -- /bin/bash

4. ç«¯å£è½¬å‘ï¼ˆæœ¬åœ°è®¿é—®ï¼‰:
   {{- if .Values.switAuth.enabled }}
   # è®¤è¯æœåŠ¡
   kubectl port-forward -n {{ include "swit.namespace" . }} svc/{{ include "swit.auth.fullname" . }}-service {{ .Values.switAuth.service.port }}:{{ .Values.switAuth.service.port }}
   {{- end }}
   
   {{- if .Values.switServe.enabled }}
   # ä¸»è¦æœåŠ¡
   kubectl port-forward -n {{ include "swit.namespace" . }} svc/{{ include "swit.serve.fullname" . }}-service {{ .Values.switServe.service.port }}:{{ .Values.switServe.service.port }}
   {{- end }}
   
   {{- if .Values.consul.enabled }}
   # Consul UI
   kubectl port-forward -n {{ include "swit.namespace" . }} svc/{{ include "swit.consul.fullname" . }}-service {{ .Values.consul.service.httpPort }}:{{ .Values.consul.service.httpPort }}
   {{- end }}

5. æ‰©å®¹/ç¼©å®¹:
   {{- if .Values.switAuth.enabled }}
   # è®¤è¯æœåŠ¡
   kubectl scale deployment -n {{ include "swit.namespace" . }} {{ include "swit.auth.fullname" . }} --replicas=<æ•°é‡>
   {{- end }}
   
   {{- if .Values.switServe.enabled }}
   # ä¸»è¦æœåŠ¡
   kubectl scale deployment -n {{ include "swit.namespace" . }} {{ include "swit.serve.fullname" . }} --replicas=<æ•°é‡>
   {{- end }}

ğŸ“Š å¥åº·æ£€æŸ¥:
{{- if .Values.switAuth.enabled }}
- è®¤è¯æœåŠ¡å¥åº·æ£€æŸ¥: http://<SERVICE-IP>:{{ .Values.switAuth.service.port }}/health
{{- end }}
{{- if .Values.switServe.enabled }}
- ä¸»è¦æœåŠ¡å¥åº·æ£€æŸ¥: http://<SERVICE-IP>:{{ .Values.switServe.service.port }}/health
{{- end }}

ğŸ“š API æ–‡æ¡£:
{{- if .Values.switServe.enabled }}
- API æ–‡æ¡£: http://<SERVICE-IP>:{{ .Values.switServe.service.port }}/swagger/index.html (å¦‚æœå¯ç”¨)
{{- end }}

ğŸ”„ å‡çº§/å›æ»š:
- å‡çº§: helm upgrade {{ .Release.Name }} deployments/helm -n {{ include "swit.namespace" . }} -f <your-values.yaml>
- å›æ»š: helm rollback {{ .Release.Name }} <REVISION> -n {{ include "swit.namespace" . }}
- æŸ¥çœ‹å†å²: helm history {{ .Release.Name }} -n {{ include "swit.namespace" . }}

ğŸ—‘ï¸  å¸è½½:
helm uninstall {{ .Release.Name }} -n {{ include "swit.namespace" . }}

{{- if or (not .Values.switAuth.enabled) (not .Values.switServe.enabled) }}

âš ï¸  æ³¨æ„: æŸäº›æœåŠ¡æœªå¯ç”¨ï¼Œè¯·æ£€æŸ¥ values.yaml é…ç½®:
{{- if not .Values.switAuth.enabled }}
  - è®¤è¯æœåŠ¡ (switAuth.enabled: false)
{{- end }}
{{- if not .Values.switServe.enabled }}
  - ä¸»è¦æœåŠ¡ (switServe.enabled: false)
{{- end }}
{{- end }}

ğŸ’¡ æç¤º: 
  - é¦–æ¬¡éƒ¨ç½²å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´æ¥æ‹‰å–é•œåƒå’Œåˆå§‹åŒ–æ•°æ®åº“
  - ç¡®ä¿ Docker é•œåƒå·²æ„å»ºå¹¶å¯ç”¨
  - æ£€æŸ¥æŒä¹…åŒ–å­˜å‚¨æ˜¯å¦æ­£ç¡®é…ç½®
