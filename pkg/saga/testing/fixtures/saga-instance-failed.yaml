# Saga Instance - Failed State
id: saga-instance-failed
name: Failed Payment Saga Instance
description: A saga instance that failed during payment
type: saga_instance
tags:
  - failed
  - error
  - state
metadata:
  scenario: failed_state
  stage: final

data:
  id: saga-inst-003
  definition_id: payment-failure-saga
  name: Payment Failure Saga
  description: Processing order ORD-11111
  state: failed
  current_step: 2
  total_steps: 5
  created_at: "2025-01-15T11:00:00Z"
  updated_at: "2025-01-15T11:03:45Z"
  started_at: "2025-01-15T11:00:05Z"
  initial_data:
    order_id: ORD-11111
    customer_id: CUST-999
    total_amount: 1299.99
    payment_method: credit_card
  current_data:
    order_id: ORD-11111
    customer_id: CUST-999
    total_amount: 1299.99
    inventory_reservation_id: INV-RES-111
  error:
    code: PAYMENT_DECLINED
    message: Payment was declined by the payment processor
    type: step_execution
    retryable: false
    timestamp: "2025-01-15T11:03:45Z"
    details:
      step_id: process-payment
      step_index: 2
      decline_reason: insufficient_funds
      processor_code: "51"
  timeout: 5m
  step_states:
    - id: step-0
      saga_id: saga-inst-003
      step_index: 0
      name: Validate Order
      state: completed
      attempts: 1
      max_attempts: 3
      created_at: "2025-01-15T11:00:05Z"
      started_at: "2025-01-15T11:00:05Z"
      completed_at: "2025-01-15T11:00:10Z"
      output_data:
        valid: true
    - id: step-1
      saga_id: saga-inst-003
      step_index: 1
      name: Reserve Inventory
      state: completed
      attempts: 1
      max_attempts: 3
      created_at: "2025-01-15T11:00:10Z"
      started_at: "2025-01-15T11:00:11Z"
      completed_at: "2025-01-15T11:02:00Z"
      output_data:
        reservation_id: INV-RES-111
    - id: step-2
      saga_id: saga-inst-003
      step_index: 2
      name: Process Payment (Fails)
      state: failed
      attempts: 2
      max_attempts: 2
      created_at: "2025-01-15T11:02:00Z"
      started_at: "2025-01-15T11:02:01Z"
      last_attempt_at: "2025-01-15T11:03:45Z"
      input_data:
        amount: 1299.99
        payment_method: credit_card
      error:
        code: PAYMENT_DECLINED
        message: Payment declined by processor
        type: step_execution
        retryable: false
        timestamp: "2025-01-15T11:03:45Z"
        details:
          decline_reason: insufficient_funds
          processor_code: "51"
  metadata:
    trace_id: trace-fail123
    failure_reason: payment_declined
  trace_id: trace-fail123
  span_id: span-fail456
  version: 5

