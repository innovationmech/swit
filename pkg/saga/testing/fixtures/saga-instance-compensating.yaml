# Saga Instance - Compensating State
id: saga-instance-compensating
name: Compensating Saga Instance
description: A saga instance currently executing compensation
type: saga_instance
tags:
  - compensating
  - rollback
  - state
metadata:
  scenario: compensating_state
  stage: compensation

data:
  id: saga-inst-004
  definition_id: compensation-saga-001
  name: Order Cancellation Saga
  description: Compensating order ORD-22222
  state: compensating
  current_step: 3
  total_steps: 5
  created_at: "2025-01-15T12:00:00Z"
  updated_at: "2025-01-15T12:06:00Z"
  started_at: "2025-01-15T12:00:05Z"
  initial_data:
    order_id: ORD-22222
    customer_id: CUST-888
    total_amount: 899.99
  current_data:
    order_id: ORD-22222
    customer_id: CUST-888
    total_amount: 899.99
    compensation_in_progress: true
  error:
    code: WAREHOUSE_UNAVAILABLE
    message: No warehouse available for allocation
    type: step_execution
    retryable: false
    timestamp: "2025-01-15T12:05:00Z"
    details:
      step_id: allocate-warehouse
      step_index: 3
  timeout: 10m
  step_states:
    - id: step-0
      saga_id: saga-inst-004
      step_index: 0
      name: Create Order
      state: completed
      attempts: 1
      max_attempts: 3
      created_at: "2025-01-15T12:00:05Z"
      started_at: "2025-01-15T12:00:05Z"
      completed_at: "2025-01-15T12:00:30Z"
      output_data:
        order_id: ORD-22222
        order_created_at: "2025-01-15T12:00:30Z"
      compensation_state:
        state: pending
        attempts: 0
        max_attempts: 3
    - id: step-1
      saga_id: saga-inst-004
      step_index: 1
      name: Reserve Inventory
      state: completed
      attempts: 1
      max_attempts: 3
      created_at: "2025-01-15T12:00:30Z"
      started_at: "2025-01-15T12:00:31Z"
      completed_at: "2025-01-15T12:02:00Z"
      output_data:
        reservation_id: INV-RES-222
      compensation_state:
        state: pending
        attempts: 0
        max_attempts: 3
    - id: step-2
      saga_id: saga-inst-004
      step_index: 2
      name: Charge Payment
      state: completed
      attempts: 1
      max_attempts: 3
      created_at: "2025-01-15T12:02:00Z"
      started_at: "2025-01-15T12:02:01Z"
      completed_at: "2025-01-15T12:04:30Z"
      output_data:
        transaction_id: TXN-777666
        amount_charged: 899.99
      compensation_state:
        state: running
        attempts: 1
        max_attempts: 3
        started_at: "2025-01-15T12:05:30Z"
    - id: step-3
      saga_id: saga-inst-004
      step_index: 3
      name: Allocate Warehouse (Fails)
      state: failed
      attempts: 1
      max_attempts: 1
      created_at: "2025-01-15T12:04:30Z"
      started_at: "2025-01-15T12:04:31Z"
      last_attempt_at: "2025-01-15T12:05:00Z"
      error:
        code: WAREHOUSE_UNAVAILABLE
        message: No warehouse available
        type: step_execution
        retryable: false
        timestamp: "2025-01-15T12:05:00Z"
  metadata:
    trace_id: trace-comp123
    compensation_started_at: "2025-01-15T12:05:30Z"
  trace_id: trace-comp123
  span_id: span-comp456
  version: 8

